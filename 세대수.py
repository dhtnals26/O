import streamlit as st
import pandas as pd

# í˜ì´ì§€ ì„¤ì •
st.set_page_config(page_title="ì—°ë„ë³„ ì¸êµ¬ ë° ì„¸ëŒ€ ë³€í™”", layout="wide")

# ì œëª©
st.title("ğŸ“Š ì—°ë„ë³„ ì£¼ë¯¼ë“±ë¡ ì¸êµ¬ ë° ì„¸ëŒ€ ë³€í™”")

# íŒŒì¼ ì—…ë¡œë“œ
uploaded_file = st.file_uploader("CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš” (EUC-KR ì¸ì½”ë”©)", type=["csv"])

if uploaded_file is not None:
    try:
        # CSV ì½ê¸°
        df = pd.read_csv(uploaded_file, encoding="euc-kr")

        # ì›ë³¸ ë°ì´í„° í‘œì‹œ
        st.subheader("ğŸ“„ ì›ë³¸ ë°ì´í„°")
        st.dataframe(df)

        # í•„ìš”í•œ ì—´ë§Œ ì¶”ì¶œ
        # 'ì—°ë„', 'ì´ì¸êµ¬ìˆ˜ (ëª…)', 'ì„¸ëŒ€ìˆ˜ (ì„¸ëŒ€)' ë¼ëŠ” ì´ë¦„ì´ ìˆì„ ê²ƒìœ¼ë¡œ ê°€ì •
        if 'ì—°ë„' in df.columns and 'ì´ì¸êµ¬ìˆ˜ (ëª…)' in df.columns and 'ì„¸ëŒ€ìˆ˜ (ì„¸ëŒ€)' in df.columns:
            df_filtered = df[['ì—°ë„', 'ì´ì¸êµ¬ìˆ˜ (ëª…)', 'ì„¸ëŒ€ìˆ˜ (ì„¸ëŒ€)']].copy()

            # ì—°ë„ë¥¼ datetime í˜•íƒœë¡œ ë³€í™˜ (ë˜ëŠ” int ì²˜ë¦¬)
            df_filtered['ì—°ë„'] = pd.to_numeric(df_filtered['ì—°ë„'], errors='coerce')
            df_filtered.dropna(inplace=True)
            df_filtered.set_index('ì—°ë„', inplace=True)

            # ì„  ê·¸ë˜í”„ ì‹œê°í™”
            st.subheader("ğŸ“ˆ ì—°ë„ë³„ ì´ì¸êµ¬ìˆ˜ ë³€í™”")
            st.line_chart(df_filtered[['ì´ì¸êµ¬ìˆ˜ (ëª…)']])

            st.subheader("ğŸ“ˆ ì—°ë„ë³„ ì„¸ëŒ€ìˆ˜ ë³€í™”")
            st.line_chart(df_filtered[['ì„¸ëŒ€ìˆ˜ (ì„¸ëŒ€)']])

            # ì¸êµ¬ìˆ˜ + ì„¸ëŒ€ìˆ˜ ë¹„êµ ê·¸ë˜í”„
            st.subheader("ğŸ“ˆ ì—°ë„ë³„ ì´ì¸êµ¬ìˆ˜ ë° ì„¸ëŒ€ìˆ˜ ë¹„êµ")
            st.line_chart(df_filtered)

            # ê²°ë¡ 
            st.markdown("""
            ### ğŸ“Œ ê²°ë¡ 
            ì´ì¸êµ¬ëŠ” ì¤„ê³  ìˆì§€ë§Œ ì„¸ëŒ€ ìˆ˜ëŠ” ê³„ì† ì¦ê°€í•˜ê³  ìˆìœ¼ë©°,  
            íŠ¹íˆ **1ì¸ ê°€êµ¬ ë¹„ìœ¨ì´ ë¹ ë¥´ê²Œ ëŠ˜ê³  ìˆìŠµë‹ˆë‹¤**.  
            ì´ëŠ” **í˜¼ì¸ìœ¨ ê°ì†Œ, ê³ ë ¹í™”, ê°œì¸í™”** ë“±ì˜ ì‚¬íšŒ ë³€í™” ë•Œë¬¸ì´ë©°,  
            ì•ìœ¼ë¡œ **ì£¼ê±°Â·ë³µì§€ ì •ì±…ì˜ ë³€í™”ê°€ í•„ìš”í•¨**ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.
            """)

        else:
            st.warning("í•„ìš”í•œ ì—´('ì—°ë„', 'ì´ì¸êµ¬ìˆ˜ (ëª…)', 'ì„¸ëŒ€ìˆ˜ (ì„¸ëŒ€)')ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì—´ ì´ë¦„ì„ í™•ì¸í•´ì£¼ì„¸ìš”.")

    except Exception as e:
        st.error(f"íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")
else:
    st.info("ì™¼ìª½ ì‚¬ì´ë“œë°” ë˜ëŠ” ìœ„ì—ì„œ CSV íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.")
